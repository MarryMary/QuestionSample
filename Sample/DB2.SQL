CREATE DATABASE DEVAPP;

USE DEVAPP;

CREATE TABLE Exercise(
    ExName VARCHAR(255) NOT NULL,
    ExYear VARCHAR(2) NOT NULL,
    ExSeason VARCHAR(3),
    ExType VARCHAR(3) NOT NULL,
    ExTags VARCHAR(500) NOT NULL,
    ExTimeUp VARCHAR(8) NOT NULL,
    PRIMARY KEY(ExName, ExType)
);

CREATE TABLE Question(
    ExName VARCHAR(255) NOT NULL,
    ExType VARCHAR(3) NOT NULL,
    QName VARCHAR(255) NOT NULL,
    QTags VARCHAR(255) NOT NULL,
    QMain VARCHAR(500) NOT NULL,
    AnswerArea VARCHAR(255) NOT NULL,
    QAnswer VARCHAR(500) NOT NULL,
    QChoice VARCHAR(500) NOT NULL,
    QScore INT NOT NULL,
    PRIMARY KEY(ExName, ExType, QName),
    FOREIGN KEY(ExName, ExType) REFERENCES Exercise(ExName, ExType) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE Respondent(
    ManageId BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    UserId BIGINT NOT NULL,
    ExName VARCHAR(255) NOT NULL,
    ExType VARCHAR(3) NOT NULL,
    QName VARCHAR(255) NOT NULL,
    Score INT NOT NULL,
    CrWr INT NOT NULL,
    RecordedAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY(ExName, ExType, QName) REFERENCES Question(ExName, ExType, QName) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE ExCreator(
    ExName VARCHAR(255) NOT NULL,
    ExType VARCHAR(3) NOT NULL,
    UserId BIGINT NOT NULL,
    Gr_OR_U INT NOT NULL,
    PRIMARY KEY(ExName, ExType, UserId),
    FOREIGN KEY(ExName, ExType) REFERENCES Exercise(ExName, ExType) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE QCreator(
    ExName VARCHAR(255) NOT NULL,
    ExType VARCHAR(3) NOT NULL,
    QName VARCHAR(255) NOT NULL,
    UserId BIGINT NOT NULL,
    Q_OR_Ex INT NOT NULL,
    PRIMARY KEY(ExName, ExType, QName, UserId),
    FOREIGN KEY(ExName, ExType, QName) REFERENCES Question(ExName, ExType, QName) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE Fix(
    Id BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    ExName VARCHAR(255) NOT NULL,
    ExType VARCHAR(3) NOT NULL,
    QName VARCHAR(255) NOT NULL,
    main_text TEXT NOT NULL,
    FOREIGN KEY(ExName, ExType, QName) REFERENCES Question(ExName, ExType, QName) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE Fixer(
    Sys_Manage_Id BIGINT NOT NULL PRIMARY KEY,
    Admin_Id BIGINT NOT NULL,
    ExName VARCHAR(255) NOT NULL,
    ExType VARCHAR(3) NOT NULL,
    QName VARCHAR(255) NOT NULL,
    Edit_Limit DATETIME NOT NULL,
    FOREIGN KEY(ExName, ExType, QName) REFERENCES Question(ExName, ExType, QName) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE PreUser(
    id BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    user_token VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL,
    register_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    register_type INT(1) NOT NULL,
    affect_id BIGINT
);

CREATE TABLE User(
    id BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    email VARCHAR(256) NOT NULL,
    user_name VARCHAR(255) NOT NULL,
    pass VARCHAR(255) NOT NULL,
    user_pict VARCHAR(255) NOT NULL,
    GAuthID VARCHAR(255),
    delete_at DATETIME,
    IsTwoFactor INT(0) NOT NULL DEFAULT 0,
    TwoFactorSecret VARCHAR(255),
    delete_flag INT(1) NOT NULL DEFAULT 0
);

CREATE TABLE UserRoll(
    Management_SysId BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    UserId BIGINT NOT NULL,
    Roll INT(3) NOT NULL,
    FOREIGN KEY(UserId) REFERENCES User(id) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE RollType(
    System_Manage_Id BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    RollType BIGINT NOT NULL,
    RollName VARCHAR(10) NOT NULL,
    RollActivity VARCHAR(10) NOT NULL
);

CREATE TABLE CreatorsGroup(
    System_ManagementId BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    UserId BIGINT NOT NULL,
    GroupName VARCHAR(50) NOT NULL
)