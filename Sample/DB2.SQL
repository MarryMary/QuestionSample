CREATE DATABASE DEVAPP;

USE DEVAPP;

CREATE TABLE Exercise(
    ExName VARCHAR(255) NOT NULL,
    ExYear DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    ExSeason VARCHAR(3) NOT NULL,
    ExType VARCHAR(3) NOT NULL,
    ExTags VARCHAR(500) NOT NULL,
    ExTimeUp VARCHAR(8) NOT NULL,
    PRIMARY KEY(ExName, ExType)
);

CREATE TABLE Question(
    ExName VARCHAR(255) NOT NULL,
    ExType VARCHAR(3) NOT NULL,
    QName VARCHAR(255) NOT NULL,
    QTags VARCHAR(255) NOT NULL,
    QMain VARCHAR(500) NOT NULL,
    AnswerArea VARCHAR(255) NOT NULL,
    QAnswer VARCHAR(500) NOT NULL,
    QChoice VARCHAR(500) NOT NULL,
    QScore INT NOT NULL,
    PRIMARY KEY(ExName, ExType, QName),
    FOREIGN KEY(ExName, ExType) REFERENCES Exercise(ExName, ExType) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE Respondent(
    ManageId BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    UId BIGINT NOT NULL,
    ExName VARCHAR(255) NOT NULL,
    ExType VARCHAR(3) NOT NULL,
    QName VARCHAR(255) NOT NULL,
    Score INT NOT NULL,
    CrWr INT NOT NULL,
    RecordedAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY(ExName, ExType, QName) REFERENCES Question(ExName, ExType, QName) ON UPDATE CASCADE ON DELETE SET NULL
);

CREATE TABLE Creator(
    C_Manage_Id BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    ExName VARCHAR(255) NOT NULL,
    ExType VARCHAR(3) NOT NULL,
    QName VARCHAR(255) NOT NULL,
    UId BIGINT NOT NULL,
    Gr_OR_U INT NOT NULL,
    Q_OR_Ex INT NOT NULL,
    FOREIGN KEY(ExName, ExType, QName) REFERENCES Question(ExName, ExType, QName) ON UPDATE CASCADE ON DELETE SET NULL
);

CREATE TABLE Fix(
    Id BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    ExName VARCHAR(255) NOT NULL,
    ExType VARCHAR(3) NOT NULL,
    QName VARCHAR(255) NOT NULL,
    FOREIGN KEY(ExName, ExType, QName) REFERENCES Question(ExName, ExType, QName) ON UPDATE CASCADE ON DELETE SET NULL,
    Text TEXT NOT NULL
);

CREATE TABLE Fixer(
    Sys_Manage_Id BIGINT NOT NULL PRIMARY KEY,
    Admin_Id BIGINT NOT NULL,
    ExName VARCHAR(255) NOT NULL,
    ExType VARCHAR(3) NOT NULL,
    QName VARCHAR(255) NOT NULL,
    Limit DATETIME NOT NULL,
    FOREIGN KEY(ExName, ExType, QName) REFERENCES Question(ExName, ExType, QName) ON UPDATE CASCADE ON DELETE SET NULL,
)